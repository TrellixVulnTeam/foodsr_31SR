{"ast":null,"code":"import UnsupportedOperationException from '../UnsupportedOperationException';\nimport CharacterSetECI from '../common/CharacterSetECI';\n/**\n * Responsible for en/decoding strings.\n */\n\nvar StringEncoding = function () {\n  function StringEncoding() {}\n  /**\n   * Decodes some Uint8Array to a string format.\n   */\n\n\n  StringEncoding.decode = function (bytes, encoding) {\n    var encodingName = this.encodingName(encoding);\n\n    if (this.customDecoder) {\n      return this.customDecoder(bytes, encodingName);\n    } // Increases browser support.\n\n\n    if (typeof TextDecoder === 'undefined' || this.shouldDecodeOnFallback(encodingName)) {\n      return this.decodeFallback(bytes, encodingName);\n    }\n\n    return new TextDecoder(encodingName).decode(bytes);\n  };\n  /**\n   * Checks if the decoding method should use the fallback for decoding\n   * once Node TextDecoder doesn't support all encoding formats.\n   *\n   * @param encodingName\n   */\n\n\n  StringEncoding.shouldDecodeOnFallback = function (encodingName) {\n    return !StringEncoding.isBrowser() && encodingName === 'ISO-8859-1';\n  };\n  /**\n   * Encodes some string into a Uint8Array.\n   */\n\n\n  StringEncoding.encode = function (s, encoding) {\n    var encodingName = this.encodingName(encoding);\n\n    if (this.customEncoder) {\n      return this.customEncoder(s, encodingName);\n    } // Increases browser support.\n\n\n    if (typeof TextEncoder === 'undefined') {\n      return this.encodeFallback(s);\n    } // TextEncoder only encodes to UTF8 by default as specified by encoding.spec.whatwg.org\n\n\n    return new TextEncoder().encode(s);\n  };\n\n  StringEncoding.isBrowser = function () {\n    return typeof window !== 'undefined' && {}.toString.call(window) === '[object Window]';\n  };\n  /**\n   * Returns the string value from some encoding character set.\n   */\n\n\n  StringEncoding.encodingName = function (encoding) {\n    return typeof encoding === 'string' ? encoding : encoding.getName();\n  };\n  /**\n   * Returns character set from some encoding character set.\n   */\n\n\n  StringEncoding.encodingCharacterSet = function (encoding) {\n    if (encoding instanceof CharacterSetECI) {\n      return encoding;\n    }\n\n    return CharacterSetECI.getCharacterSetECIByName(encoding);\n  };\n  /**\n   * Runs a fallback for the native decoding funcion.\n   */\n\n\n  StringEncoding.decodeFallback = function (bytes, encoding) {\n    var characterSet = this.encodingCharacterSet(encoding);\n\n    if (StringEncoding.isDecodeFallbackSupported(characterSet)) {\n      var s = '';\n\n      for (var i = 0, length_1 = bytes.length; i < length_1; i++) {\n        var h = bytes[i].toString(16);\n\n        if (h.length < 2) {\n          h = '0' + h;\n        }\n\n        s += '%' + h;\n      }\n\n      return decodeURIComponent(s);\n    }\n\n    if (characterSet.equals(CharacterSetECI.UnicodeBigUnmarked)) {\n      return String.fromCharCode.apply(null, new Uint16Array(bytes.buffer));\n    }\n\n    throw new UnsupportedOperationException(\"Encoding \" + this.encodingName(encoding) + \" not supported by fallback.\");\n  };\n\n  StringEncoding.isDecodeFallbackSupported = function (characterSet) {\n    return characterSet.equals(CharacterSetECI.UTF8) || characterSet.equals(CharacterSetECI.ISO8859_1) || characterSet.equals(CharacterSetECI.ASCII);\n  };\n  /**\n   * Runs a fallback for the native encoding funcion.\n   *\n   * @see https://stackoverflow.com/a/17192845/4367683\n   */\n\n\n  StringEncoding.encodeFallback = function (s) {\n    var encodedURIstring = btoa(unescape(encodeURIComponent(s)));\n    var charList = encodedURIstring.split('');\n    var uintArray = [];\n\n    for (var i = 0; i < charList.length; i++) {\n      uintArray.push(charList[i].charCodeAt(0));\n    }\n\n    return new Uint8Array(uintArray);\n  };\n\n  return StringEncoding;\n}();\n\nexport default StringEncoding; //# sourceMappingURL=StringEncoding.js.map","map":null,"metadata":{},"sourceType":"module"}